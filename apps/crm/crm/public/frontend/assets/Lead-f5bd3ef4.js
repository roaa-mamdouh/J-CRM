import{a as xe}from"./FadedScrollableDiv-9739b5b1.js";import{_ as we,a as he}from"./SidePanelModal-38441ea1.js";import{E as ke,_ as Q}from"./views-29c7636e.js";import{u as Ve,_ as Ie,A as Le,E as $e,a as X,b as Ue,S as ze}from"./useActiveTabManager-d63d67a2.js";import{E as Ee}from"./Email2Icon-114a3543.js";import{C as Ae}from"./CommentIcon-552fbe88.js";import{P as Y}from"./PhoneIcon-206b2bf3.js";import{T as Se}from"./TaskIcon-a509cbac.js";import{N as Te}from"./NoteModal-ee3b9103.js";import{W as Me}from"./WhatsAppIcon-c40bbe0a.js";import{I as Ne}from"./IndicatorIcon-4dd9059c.js";import{C as Re}from"./CameraIcon-002a69e5.js";import{L as je}from"./LinkIcon-4bbaca23.js";import{O as qe}from"./OrganizationsIcon-18979377.js";import{C as Fe}from"./ContactsIcon-3965efd8.js";import{_ as Be}from"./LayoutHeader-1f47b812.js";import{_ as De}from"./AssignmentModal-b1255d73.js";import{s as Oe,_ as Pe}from"./statuses-7de18649.js";import{_ as We}from"./Section-8b41410b.js";import{g as Ge,_ as Je,S as Ke}from"./view-2824ccd2.js";import{_ as He}from"./CustomActions-4aa71942.js";import{g as Qe,u as Xe,e as k,s as Ye,i as Ze,j as ea,b as aa,_ as U,k as B,o as ta}from"./index-79582337.js";import{c as sa}from"./contacts-945ac9fb.js";import{c as Z,w as oa}from"./settings-76fff180.js";import{h as la,v as na,l as c,x as D,I as O,a as ia,j as ee,K as da,k as ra,r as M,b as d,c as y,u as a,g as _,w as n,p,d as l,L as P,F as ae,z as ua,G as te,n as se,e as u,t as b,C as ma,f as ca,E as _a}from"./index-94cddbf2.js";import{_ as pa}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-ac4cff83.js";import{_ as oe}from"./Dropdown.vue_vue_type_script_setup_true_lang-f30ca23a.js";import{F as fa}from"./FileUploader-22e9b494.js";import{_ as le}from"./Switch.vue_vue_type_script_setup_true_lang-34bdad39.js";import"./DragVerticalIcon-2b8c1048.js";import"./CalendarIcon-64a87471.js";import"./callLog-4af9dda9.js";import"./IconPicker-43902fe0.js";import"./LeadsIcon-86dc61b1.js";import"./DealsIcon-c75ef9a8.js";import"./EmailTemplateModal-8c6fb82c.js";import"./TaskModal-d3bb0e4f.js";import"./ArrowUpRightIcon-1f7d0656.js";const va={key:1,class:"flex h-full overflow-hidden"},ba={class:"flex items-center justify-start gap-5 border-b p-5"},ga={class:"group relative size-12"},ya={class:"z-1 absolute bottom-0.5 left-0 right-0.5 flex h-9 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-3 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(12px 0 0 0)","clip-path":"inset(12px 0 0 0)"}},Ca={class:"flex flex-col gap-2.5 truncate"},xa={class:"truncate text-2xl font-medium"},wa={class:"flex gap-1.5"},ha={key:1,class:"flex flex-1 flex-col justify-between overflow-hidden"},ka={class:"flex flex-col overflow-y-auto"},Va={class:"mb-4 flex items-center gap-2 text-gray-600"},Ia={class:"block text-base"},La={class:"ml-6"},$a={class:"flex items-center justify-between text-base"},Ua={key:1,class:"mt-2.5 text-base"},za={class:"mb-4 mt-6 flex items-center gap-2 text-gray-600"},Ea={class:"block text-base"},Aa={class:"ml-6"},Sa={class:"flex items-center justify-between text-base"},Ta={key:1,class:"mt-2.5 text-base"},yt={__name:"Lead",props:{leadId:{type:String,required:!0}},setup(ne){const{$dialog:ie,$socket:de,makeCall:re}=Qe(),{getContactByName:V,contacts:ue}=sa(),{statusOptions:me,getLeadStatus:ce}=Oe(),{isManager:_e}=Xe(),v=la(),N=na(),I=ne,R=c([]),W=c([]),t=D({url:"crm.fcrm.doctype.crm_lead.api.get_lead",params:{name:I.leadId},cache:["lead",I.leadId],onSuccess:async s=>{let e={doc:s,$dialog:ie,$socket:de,router:N,updateField:x,createToast:k,deleteDoc:ge,resource:{lead:t,fieldsLayout:C},call:O};Ye(s);let i=await Ze(s,e);R.value=i.actions||[],W.value=i.statuses||[]}});ia(()=>{t.data||t.fetch()});const j=c(!1),z=c(!1),E=c(!1),q=c(!1);function G(s,e,i){e=Array.isArray(s)?"":e,!(!Array.isArray(s)&&pe(s,e))&&D({url:"frappe.client.set_value",params:{doctype:"CRM Lead",name:I.leadId,fieldname:s,value:e},auto:!0,onSuccess:()=>{t.reload(),j.value=!0,k({title:__("Lead updated"),icon:"check",iconClasses:"text-green-600"}),i==null||i()},onError:m=>{var T;k({title:__("Error updating lead"),text:__((T=m.messages)==null?void 0:T[0]),icon:"x",iconClasses:"text-red-600"})}})}function pe(s,e){var m;let i=t.data.fields_meta||{};return(m=i[s])!=null&&m.reqd&&!e?(k({title:__("Error Updating Lead"),text:__("{0} is a required field",[i[s].label]),icon:"x",iconClasses:"text-red-600"}),!0):!1}const fe=ee(()=>{let s=[{label:__("Leads"),route:{name:"Leads"}}];if(v.query.view||v.query.viewType){let e=Ge(v.query.view,v.query.viewType,"CRM Lead");e&&s.push({label:__(e.label),icon:e.icon,route:{name:"Leads",params:{viewType:v.query.viewType},query:{view:v.query.view}}})}return s.push({label:t.data.lead_name||__("Untitled"),route:{name:"Lead",params:{leadId:t.data.name}}}),s});da(()=>{var s,e;return{title:((s=t.data)==null?void 0:s.lead_name)||((e=t.data)==null?void 0:e.name)}});const A=ee(()=>[{name:"Activity",label:__("Activity"),icon:Le},{name:"Emails",label:__("Emails"),icon:$e},{name:"Comments",label:__("Comments"),icon:Ae},{name:"Calls",label:__("Calls"),icon:Y,condition:()=>Z.value},{name:"Tasks",label:__("Tasks"),icon:Se},{name:"Notes",label:__("Notes"),icon:Te},{name:"Attachments",label:__("Attachments"),icon:X},{name:"WhatsApp",label:__("WhatsApp"),icon:Me,condition:()=>oa.value}].filter(e=>e.condition?e.condition():!0)),{tabIndex:g,changeTabTo:ve}=Ve(A,"lastLeadTab");ra(A,s=>{if(s&&v.params.tabName){let e=s.findIndex(i=>i.name.toLowerCase()===v.params.tabName.toLowerCase());e!==-1&&(g.value=e)}});function be(s){let e=s.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(e))return __("Only PNG and JPG images are allowed")}const C=D({url:"crm.api.doc.get_sidebar_fields",cache:["fieldsLayout",I.leadId],params:{doctype:"CRM Lead",name:I.leadId},auto:!0});function x(s,e,i){G(s,e,()=>{t.data[s]=e,i==null||i()})}async function ge(s){await O("frappe.client.delete",{doctype:"CRM Lead",name:s}),N.push({name:"Leads"})}const S=c(!1),w=c(!1),h=c(!1),f=c(""),L=c("");async function J(s){let e=!1;if(w.value&&!f.value){k({title:__("Error"),text:__("Please select an existing contact"),icon:"x",iconClasses:"text-red-600"});return}if(h.value&&!L.value){k({title:__("Error"),text:__("Please select an existing organization"),icon:"x",iconClasses:"text-red-600"});return}if(w.value&&f.value&&(t.data.salutation=V(f.value).salutation,t.data.first_name=V(f.value).first_name,t.data.last_name=V(f.value).last_name,t.data.email_id=V(f.value).email_id,t.data.mobile_no=V(f.value).mobile_no,w.value=!1,e=!0),h.value&&L.value&&(t.data.organization=L.value,h.value=!1,e=!0),e)G({salutation:t.data.salutation,first_name:t.data.first_name,last_name:t.data.last_name,email_id:t.data.email_id,mobile_no:t.data.mobile_no,organization:t.data.organization},"",()=>J(!0)),S.value=!1;else{let i=await O("crm.fcrm.doctype.crm_lead.crm_lead.convert_to_deal",{lead:t.data.name});i&&(ua("convert_lead_to_deal"),s&&await ue.reload(),N.push({name:"Deal",params:{dealId:i}}))}}const F=c(null);function ye(){F.value.emailBox.show=!0}return(s,e)=>{var K,H;const i=M("FeatherIcon"),m=M("Button"),T=M("ErrorMessage"),Ce=M("Dialog");return d(),y(ae,null,[a(t).data?(d(),_(Be,{key:0},{"left-header":n(()=>[l(a(pa),{items:fe.value},{prefix:n(({item:o})=>[o.icon?(d(),_(xe,{key:0,icon:o.icon,class:"mr-2 h-4"},null,8,["icon"])):p("",!0)]),_:1},8,["items"])]),"right-header":n(()=>{var o;return[R.value?(d(),_(He,{key:0,actions:R.value},null,8,["actions"])):p("",!0),(d(),_(te(((o=a(t).data._assignedTo)==null?void 0:o.length)==1?"Button":"div"),null,{default:n(()=>[l(Pe,{avatars:a(t).data._assignedTo,onClick:e[0]||(e[0]=r=>z.value=!0)},null,8,["avatars"])]),_:1})),l(a(oe),{options:a(me)("lead",x,W.value)},{default:n(({open:r})=>[l(m,{label:a(t).data.status,class:se(a(ce)(a(t).data.status).colorClass)},{prefix:n(()=>[l(Ne)]),suffix:n(()=>[l(i,{name:r?"chevron-up":"chevron-down",class:"h-4"},null,8,["name"])]),_:2},1032,["label","class"])]),_:1},8,["options"]),l(m,{label:s.__("Convert to Deal"),variant:"solid",onClick:e[1]||(e[1]=r=>S.value=!0)},null,8,["label"])]}),_:1})):p("",!0),(K=a(t))!=null&&K.data?(d(),y("div",va,[l(a(Je),{modelValue:a(g),"onUpdate:modelValue":e[5]||(e[5]=o=>P(g)?g.value=o:null),tabs:A.value},{default:n(({tab:o})=>[l(Ue,{ref_key:"activities",ref:F,doctype:"CRM Lead",tabs:A.value,reload:j.value,"onUpdate:reload":e[2]||(e[2]=r=>j.value=r),tabIndex:a(g),"onUpdate:tabIndex":e[3]||(e[3]=r=>P(g)?g.value=r:null),modelValue:a(t),"onUpdate:modelValue":e[4]||(e[4]=r=>P(t)?t.value=r:null)},null,8,["tabs","reload","tabIndex","modelValue"])]),_:1},8,["modelValue","tabs"]),l(we,{class:"flex flex-col justify-between border-l",side:"right"},{default:n(()=>[u("div",{class:"flex h-10.5 cursor-copy items-center border-b px-5 py-2.5 text-lg font-medium",onClick:e[6]||(e[6]=o=>a(ea)(a(t).data.name))},b(s.__(a(t).data.name)),1),l(a(fa),{onSuccess:e[11]||(e[11]=o=>x("image",o.file_url)),validateFile:be},{default:n(({openFileSelector:o,error:r})=>[u("div",ba,[u("div",ga,[l(a(aa),{size:"3xl",class:"size-12",label:a(t).data.first_name||s.__("Untitled"),image:a(t).data.image},null,8,["label","image"]),(d(),_(te(a(t).data.image?a(oe):"div"),ma(a(t).data.image?{options:[{icon:"upload",label:a(t).data.image?s.__("Change image"):s.__("Upload image"),onClick:o},{icon:"trash-2",label:s.__("Remove image"),onClick:()=>x("image","")}]}:{onClick:o},{class:"!absolute bottom-0 left-0 right-0"}),{default:n(()=>[u("div",ya,[l(Re,{class:"size-4 cursor-pointer text-white"})])]),_:2},1040))]),u("div",Ca,[l(a(U),{text:a(t).data.lead_name||s.__("Set first name")},{default:n(()=>[u("div",xa,b(a(t).data.lead_name||s.__("Untitled")),1)]),_:1},8,["text"]),u("div",wa,[a(Z)?(d(),_(a(U),{key:0,text:s.__("Make a call")},{default:n(()=>[l(m,{class:"h-7 w-7",onClick:e[7]||(e[7]=()=>a(t).data.mobile_no?a(re)(a(t).data.mobile_no):a(B)(s.__("No phone number set")))},{default:n(()=>[l(Y,{class:"h-4 w-4"})]),_:1})]),_:1},8,["text"])):p("",!0),l(a(U),{text:s.__("Send an email")},{default:n(()=>[l(m,{class:"h-7 w-7"},{default:n(()=>[l(Ee,{class:"h-4 w-4",onClick:e[8]||(e[8]=$=>a(t).data.email?ye():a(B)(s.__("No email set")))})]),_:1})]),_:1},8,["text"]),l(a(U),{text:s.__("Go to website")},{default:n(()=>[l(m,{class:"h-7 w-7"},{default:n(()=>[l(je,{class:"h-4 w-4",onClick:e[9]||(e[9]=$=>a(t).data.website?a(ta)(a(t).data.website):a(B)(s.__("No website set")))})]),_:1})]),_:1},8,["text"]),l(a(U),{text:s.__("Attach a file")},{default:n(()=>[l(m,{class:"h-7 w-7",onClick:e[10]||(e[10]=$=>q.value=!0)},{default:n(()=>[l(X,{class:"h-4 w-4"})]),_:1})]),_:1},8,["text"])]),l(T,{message:s.__(r)},null,8,["message"])])])]),_:1}),a(t).data.sla_status?(d(),_(ze,{key:0,modelValue:a(t).data,"onUpdate:modelValue":e[12]||(e[12]=o=>a(t).data=o),onUpdateField:x},null,8,["modelValue"])):p("",!0),a(C).data?(d(),y("div",ha,[u("div",ka,[(d(!0),y(ae,null,ca(a(C).data,(o,r)=>(d(),y("div",{key:o.label,class:se(["flex flex-col p-3",{"border-b":r!==a(C).data.length-1}])},[l(We,{"is-opened":o.opened,label:o.label},_a({default:n(()=>[l(Ke,{fields:o.fields,isLastSection:r==a(C).data.length-1,modelValue:a(t).data,"onUpdate:modelValue":e[13]||(e[13]=$=>a(t).data=$),onUpdate:x},null,8,["fields","isLastSection","modelValue"])]),_:2},[r==0&&a(_e)()?{name:"actions",fn:n(()=>[l(m,{variant:"ghost",class:"w-7 mr-2",onClick:e[14]||(e[14]=$=>E.value=!0)},{default:n(()=>[l(ke,{class:"h-4 w-4"})]),_:1})]),key:"0"}:void 0]),1032,["is-opened","label"])],2))),128))])])):p("",!0)]),_:1})])):p("",!0),z.value?(d(),_(De,{key:2,modelValue:z.value,"onUpdate:modelValue":e[15]||(e[15]=o=>z.value=o),assignees:a(t).data._assignedTo,"onUpdate:assignees":e[16]||(e[16]=o=>a(t).data._assignedTo=o),doc:a(t).data,doctype:"CRM Lead"},null,8,["modelValue","assignees","doc"])):p("",!0),l(Ce,{modelValue:S.value,"onUpdate:modelValue":e[21]||(e[21]=o=>S.value=o),options:{title:s.__("Convert to Deal"),size:"xl",actions:[{label:s.__("Convert"),variant:"solid",onClick:J}]}},{"body-content":n(()=>[u("div",Va,[l(qe,{class:"h-4 w-4"}),u("label",Ia,b(s.__("Organization")),1)]),u("div",La,[u("div",$a,[u("div",null,b(s.__("Choose Existing")),1),l(a(le),{modelValue:h.value,"onUpdate:modelValue":e[17]||(e[17]=o=>h.value=o)},null,8,["modelValue"])]),h.value?(d(),_(Q,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:L.value,doctype:"CRM Organization",onChange:e[18]||(e[18]=o=>L.value=o)},null,8,["value"])):(d(),y("div",Ua,b(s.__("New organization will be created based on the data in details section")),1))]),u("div",za,[l(Fe,{class:"h-4 w-4"}),u("label",Ea,b(s.__("Contact")),1)]),u("div",Aa,[u("div",Sa,[u("div",null,b(s.__("Choose Existing")),1),l(a(le),{modelValue:w.value,"onUpdate:modelValue":e[19]||(e[19]=o=>w.value=o)},null,8,["modelValue"])]),w.value?(d(),_(Q,{key:0,class:"form-control mt-2.5",variant:"outline",size:"md",value:f.value,doctype:"Contact",onChange:e[20]||(e[20]=o=>f.value=o)},null,8,["value"])):(d(),y("div",Ta,b(s.__("New contact will be created based on the person's details")),1))])]),_:1},8,["modelValue","options"]),E.value?(d(),_(he,{key:3,modelValue:E.value,"onUpdate:modelValue":e[22]||(e[22]=o=>E.value=o),onReload:e[23]||(e[23]=()=>a(C).reload())},null,8,["modelValue"])):p("",!0),(H=a(t).data)!=null&&H.name?(d(),_(Ie,{key:4,modelValue:q.value,"onUpdate:modelValue":e[24]||(e[24]=o=>q.value=o),doctype:"CRM Lead",docname:a(t).data.name,onAfter:e[25]||(e[25]=()=>{var o,r;(r=(o=F.value)==null?void 0:o.all_activities)==null||r.reload(),a(ve)("attachments")})},null,8,["modelValue","docname"])):p("",!0)],64)}}};export{yt as default};
//# sourceMappingURL=Lead-f5bd3ef4.js.map
