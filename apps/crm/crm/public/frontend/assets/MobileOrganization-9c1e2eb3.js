import{_ as re}from"./Section-8b41410b.js";import{g as me,S as de,_ as ce}from"./view-2824ccd2.js";import{a as ue}from"./FadedScrollableDiv-9739b5b1.js";import{_ as _e}from"./LayoutHeader-1f47b812.js";import{_ as pe}from"./AddressModal-c9e0b8b2.js";import{_ as ge}from"./DealsListView-a9ac245f.js";import{_ as fe}from"./ContactsListView-94b18f2c.js";import{D as ye}from"./DetailsIcon-24bf3ae4.js";import{C as be}from"./CameraIcon-002a69e5.js";import{D as he}from"./DealsIcon-c75ef9a8.js";import{C as ve}from"./ContactsIcon-3965efd8.js";import{u as we,g as ze,h as xe,d as $,t as j,b as ke,e as T,c as q}from"./index-79582337.js";import{s as Ce}from"./statuses-7de18649.js";import{h as Ie,v as De,J as Oe,j as y,K as Ve,l as x,x as Re,B as N,a0 as U,r as k,b as i,c as _,u as t,g as p,w as m,p as d,d as s,F as A,I as D,e as r,C as Fe,G as O,t as C,n as V,H as P,f as Me}from"./index-94cddbf2.js";import{_ as Be}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-ac4cff83.js";import{_ as Le}from"./Dropdown.vue_vue_type_script_setup_true_lang-f30ca23a.js";import{F as Se}from"./FileUploader-22e9b494.js";import"./views-29c7636e.js";import"./ArrowUpRightIcon-1f7d0656.js";import"./QuickEntryModal-c9cc5254.js";import"./Fields-0a7d93b5.js";import"./IndicatorIcon-4dd9059c.js";import"./DatePicker.vue_vue_type_script_setup_true_lang-3cf9a372.js";import"./DragVerticalIcon-2b8c1048.js";import"./Switch.vue_vue_type_script_setup_true_lang-34bdad39.js";import"./ListBulkActions-9825310d.js";import"./AssignmentModal-b1255d73.js";import"./PhoneIcon-206b2bf3.js";import"./ListRows-818fdf9d.js";import"./ListFooter-74d62f00.js";const $e={class:"relative flex h-10.5 items-center justify-between gap-2 py-2.5 pl-2"},je={key:1,class:"flex flex-col h-full overflow-hidden"},Te={class:"flex flex-col items-start justify-start gap-4 p-4"},qe={class:"flex gap-4 items-center"},Ne={class:"group relative h-14.5 w-14.5"},Ue={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},Ae={class:"flex flex-col gap-2 truncate"},Pe={class:"truncate text-lg font-medium"},Ee={class:"flex items-center gap-1.5"},Ge={key:0},Je={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},We={class:"flex flex-col overflow-y-auto"},He={key:3,class:"grid flex-1 place-items-center text-xl font-medium text-gray-500"},Ke={class:"flex flex-col items-center justify-center space-y-3"},Ia={__name:"MobileOrganization",props:{organizationId:{type:String,required:!0}},setup(E){const n=E,{getUser:R}=we(),{$dialog:G}=ze(),{getDealStatus:J}=Ce(),g=Ie(),W=De(),l=Oe({doctype:"CRM Organization",name:n.organizationId,cache:["organization",n.organizationId],fields:["*"],auto:!0});async function H(e,a){await l.setValue.submit({[e]:a}),T({title:__("Organization updated"),icon:"check",iconClasses:"text-green-600"})}const K=y(()=>{let e=[{label:__("Organizations"),route:{name:"Organizations"}}];if(g.query.view||g.query.viewType){let a=me(g.query.view,g.query.viewType,"CRM Organization");a&&e.push({label:__(a.label),icon:a.icon,route:{name:"Organizations",params:{viewType:g.query.viewType},query:{view:g.query.view}}})}return e.push({label:n.organizationId,route:{name:"Organization",params:{organizationId:n.organizationId}}}),e});Ve(()=>({title:n.organizationId}));function Q(e){let a=e.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(a))return __("Only PNG and JPG images are allowed")}async function F(e){await D("frappe.client.set_value",{doctype:"CRM Organization",name:n.organizationId,fieldname:"organization_logo",value:(e==null?void 0:e.file_url)||""}),l.reload()}async function X(){G({title:__("Delete organization"),message:__("Are you sure you want to delete this organization?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",async onClick(e){await D("frappe.client.delete",{doctype:"CRM Organization",name:n.organizationId}),e(),W.push({name:"Organizations"})}}]})}function Y(){l.doc.website?window.open(l.doc.website,"_blank"):T({title:__("Website not found"),icon:"x",iconClasses:"text-red-600"})}const v=x(!1),Z=x({}),w=x({}),z=Re({url:"crm.api.doc.get_sidebar_fields",cache:["fieldsLayout",n.organizationId],params:{doctype:"CRM Organization",name:n.organizationId},auto:!0,transform:e=>ee(e)});function ee(e){return e.map(a=>({...a,fields:y(()=>a.fields.map(c=>c.name==="address"?{...c,create:(f,I)=>{Z.value.address=f,w.value={},v.value=!0,I()},edit:async f=>{w.value=await D("frappe.client.get",{doctype:"Address",name:f}),v.value=!0}}:c))}))}const b=x(0),ae=[{name:"Details",label:__("Details"),icon:ye},{name:"Deals",label:__("Deals"),icon:N(he,{class:"h-4 w-4"}),count:y(()=>{var e;return(e=M.data)==null?void 0:e.length})},{name:"Contacts",label:__("Contacts"),icon:N(ve,{class:"h-4 w-4"}),count:y(()=>{var e;return(e=B.data)==null?void 0:e.length})}],M=U({type:"list",doctype:"CRM Deal",cache:["deals",n.organizationId],fields:["name","organization","currency","annual_revenue","status","email","mobile_no","deal_owner","modified"],filters:{organization:n.organizationId},orderBy:"modified desc",pageLength:20,auto:!0}),B=U({type:"list",doctype:"Contact",cache:["contacts",n.organizationId],fields:["name","full_name","image","email_id","mobile_no","company_name","modified"],filters:{company_name:n.organizationId},orderBy:"modified desc",pageLength:20,auto:!0}),h=y(()=>{let e=[];return e=b.value?B:M,e.data?e.data.map(a=>b.value?te(a):oe(a)):[]}),L=y(()=>b.value===0?ne:ie);function oe(e){var a,c;return{name:e.name,organization:{label:e.organization,logo:(a=n.organization)==null?void 0:a.organization_logo},annual_revenue:xe(e.annual_revenue,e.currency),status:{label:e.status,color:(c=J(e.status))==null?void 0:c.iconColorClass},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&R(e.deal_owner).full_name,...e.deal_owner&&R(e.deal_owner)},modified:{label:$(e.modified,q),timeAgo:__(j(e.modified))}}}function te(e){var a;return{name:e.name,full_name:{label:e.full_name,image_label:e.full_name,image:e.image},email:e.email_id,mobile_no:e.mobile_no,company_name:{label:e.company_name,logo:(a=n.organization)==null?void 0:a.organization_logo},modified:{label:$(e.modified,q),timeAgo:__(j(e.modified))}}}const ne=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}],ie=[{label:__("Name"),key:"full_name",width:"17rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Phone"),key:"mobile_no",width:"12rem"},{label:__("Organization"),key:"company_name",width:"12rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];return(e,a)=>{const c=k("FeatherIcon"),f=k("Button"),I=k("ErrorMessage"),le=k("Badge");return i(),_(A,null,[t(l).doc?(i(),p(_e,{key:0},{default:m(()=>[r("header",$e,[s(t(Be),{items:K.value},{prefix:m(({item:o})=>[o.icon?(i(),p(ue,{key:0,icon:o.icon,class:"mr-2 h-4"},null,8,["icon"])):d("",!0)]),_:1},8,["items"])])]),_:1})):d("",!0),t(l).doc?(i(),_("div",je,[s(t(Se),{onSuccess:F,validateFile:Q},{default:m(({openFileSelector:o,error:u})=>[r("div",Te,[r("div",qe,[r("div",Ne,[s(t(ke),{size:"3xl",class:"h-14.5 w-14.5",label:t(l).doc.organization_name,image:t(l).doc.organization_logo},null,8,["label","image"]),(i(),p(O(t(l).doc.organization_logo?t(Le):"div"),Fe(t(l).doc.organization_logo?{options:[{icon:"upload",label:t(l).doc.organization_logo?e.__("Change image"):e.__("Upload image"),onClick:o},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>F("")}]}:{onClick:o},{class:"!absolute bottom-0 left-0 right-0"}),{default:m(()=>[r("div",Ue,[s(be,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:2},1040))]),r("div",Ae,[r("div",Pe,C(t(l).doc.name),1),r("div",Ee,[s(f,{onClick:Y},{default:m(()=>[s(c,{name:"link",class:"h-4 w-4"})]),_:1}),s(f,{label:e.__("Delete"),theme:"red",size:"sm",onClick:X},{prefix:m(()=>[s(c,{name:"trash-2",class:"h-4 w-4"})]),_:1},8,["label"])]),s(I,{message:e.__(u)},null,8,["message"])])])])]),_:1}),s(t(ce),{modelValue:b.value,"onUpdate:modelValue":a[1]||(a[1]=o=>b.value=o),tabs:ae,tablistClass:"!px-4",class:"overflow-auto"},{tab:m(({tab:o,selected:u})=>[o.name!=="Details"?(i(),_("button",{key:0,class:V(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-gray-600 duration-300 ease-in-out hover:border-gray-400 hover:text-gray-900",{"text-gray-900":u}])},[o.icon?(i(),p(O(o.icon),{key:0,class:"h-5"})):d("",!0),P(" "+C(e.__(o.label))+" ",1),s(le,{class:V(["group-hover:bg-gray-900",[u?"bg-gray-900":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:m(()=>[P(C(o.count),1)]),_:2},1032,["class"])],2)):d("",!0)]),default:m(({tab:o})=>[o.name=="Details"?(i(),_("div",Ge,[t(z).data?(i(),_("div",Je,[r("div",We,[(i(!0),_(A,null,Me(t(z).data,(u,S)=>(i(),_("div",{key:u.label,class:V(["flex flex-col px-2 py-3 sm:p-3",{"border-b":S!==t(z).data.length-1}])},[s(re,{"is-opened":u.opened,label:u.label},{default:m(()=>[s(de,{fields:u.fields,isLastSection:S==t(z).data.length-1,modelValue:t(l).doc,"onUpdate:modelValue":a[0]||(a[0]=se=>t(l).doc=se),onUpdate:H},null,8,["fields","isLastSection","modelValue"])]),_:2},1032,["is-opened","label"])],2))),128))])])):d("",!0)])):d("",!0),o.label==="Deals"&&h.value.length?(i(),p(ge,{key:1,class:"mt-4",rows:h.value,columns:L.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):d("",!0),o.label==="Contacts"&&h.value.length?(i(),p(fe,{key:2,class:"mt-4",rows:h.value,columns:L.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):d("",!0),!h.value.length&&o.name!=="Details"?(i(),_("div",He,[r("div",Ke,[(i(),p(O(o.icon),{class:"!h-10 !w-10"})),r("div",null,C(e.__("No {0} Found",[e.__(o.label)])),1)])])):d("",!0)]),_:1},8,["modelValue"])])):d("",!0),s(pe,{modelValue:v.value,"onUpdate:modelValue":a[2]||(a[2]=o=>v.value=o),address:w.value,"onUpdate:address":a[3]||(a[3]=o=>w.value=o)},null,8,["modelValue","address"])],64)}}};export{Ia as default};
//# sourceMappingURL=MobileOrganization-9c1e2eb3.js.map
