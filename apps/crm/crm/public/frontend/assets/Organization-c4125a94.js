import{_ as ue,a as ce}from"./SidePanelModal-38441ea1.js";import{_ as _e}from"./Section-8b41410b.js";import{g as pe,S as fe,_ as ge}from"./view-2824ccd2.js";import{a as be}from"./FadedScrollableDiv-9739b5b1.js";import{_ as ye}from"./LayoutHeader-1f47b812.js";import{_ as ve}from"./QuickEntryModal-c9cc5254.js";import{_ as we}from"./AddressModal-c9e0b8b2.js";import{_ as he}from"./DealsListView-a9ac245f.js";import{_ as ze}from"./ContactsListView-94b18f2c.js";import{W as ke}from"./WebsiteIcon-612bfcb9.js";import{E as xe}from"./views-29c7636e.js";import{C as Ce}from"./CameraIcon-002a69e5.js";import{D as Ie}from"./DealsIcon-c75ef9a8.js";import{C as Oe}from"./ContactsIcon-3965efd8.js";import{u as Ve,g as Re,h as $e,d as j,t as T,b as Me,_ as De,e as q,c as E}from"./index-79582337.js";import{s as Fe}from"./statuses-7de18649.js";import{l as g,h as Se,v as Be,J as Le,j as b,K as Ue,x as je,B as N,a0 as A,r as O,b as n,c as y,u as t,g as u,w as d,p as m,e as i,d as s,F as P,I as R,G as $,C as Te,t as k,f as qe,n as M,H as W}from"./index-94cddbf2.js";import{_ as Ee}from"./Breadcrumbs.vue_vue_type_script_setup_true_lang-ac4cff83.js";import{_ as Ne}from"./Dropdown.vue_vue_type_script_setup_true_lang-f30ca23a.js";import{F as Ae}from"./FileUploader-22e9b494.js";import"./DragVerticalIcon-2b8c1048.js";import"./Switch.vue_vue_type_script_setup_true_lang-34bdad39.js";import"./ArrowUpRightIcon-1f7d0656.js";import"./Fields-0a7d93b5.js";import"./IndicatorIcon-4dd9059c.js";import"./DatePicker.vue_vue_type_script_setup_true_lang-3cf9a372.js";import"./ListBulkActions-9825310d.js";import"./AssignmentModal-b1255d73.js";import"./PhoneIcon-206b2bf3.js";import"./ListRows-818fdf9d.js";import"./ListFooter-74d62f00.js";const Pe={ref:"parentRef",class:"flex h-full"},We={class:"border-b"},Ge={class:"flex flex-col items-start justify-start gap-4 p-5"},Je={class:"flex gap-4 items-center"},He={class:"group relative h-15.5 w-15.5"},Ke={class:"z-1 absolute bottom-0 left-0 right-0 flex h-14 cursor-pointer items-center justify-center rounded-b-full bg-black bg-opacity-40 pt-5 opacity-0 duration-300 ease-in-out group-hover:opacity-100",style:{"-webkit-clip-path":"inset(22px 0 0 0)","clip-path":"inset(22px 0 0 0)"}},Qe={class:"flex flex-col gap-2 truncate"},Xe={class:"truncate text-2xl font-medium"},Ye={key:0,class:"flex items-center gap-1.5 text-base text-gray-800"},Ze={class:"flex gap-1.5"},ea={key:0,class:"flex flex-1 flex-col justify-between overflow-hidden"},aa={class:"flex flex-col overflow-y-auto"},oa={key:2,class:"grid flex-1 place-items-center text-xl font-medium text-gray-500"},ta={class:"flex flex-col items-center justify-center space-y-3"},Ba={__name:"Organization",props:{organizationId:{type:String,required:!0}},setup(G){const r=G,{getUser:D,isManager:J}=Ve(),{$dialog:H}=Re(),{getDealStatus:K}=Fe(),x=g(!1),V=g(!1),p=Se(),Q=Be(),l=Le({doctype:"CRM Organization",name:r.organizationId,cache:["organization",r.organizationId],fields:["*"],auto:!0});async function X(e,a){await l.setValue.submit({[e]:a}),q({title:__("Organization updated"),icon:"check",iconClasses:"text-green-600"})}const Y=b(()=>{let e=[{label:__("Organizations"),route:{name:"Organizations"}}];if(p.query.view||p.query.viewType){let a=pe(p.query.view,p.query.viewType,"CRM Organization");a&&e.push({label:__(a.label),icon:a.icon,route:{name:"Organizations",params:{viewType:p.query.viewType},query:{view:p.query.view}}})}return e.push({label:r.organizationId,route:{name:"Organization",params:{organizationId:r.organizationId}}}),e});Ue(()=>({title:r.organizationId}));function Z(e){let a=e.name.split(".").pop().toLowerCase();if(!["png","jpg","jpeg"].includes(a))return __("Only PNG and JPG images are allowed")}async function F(e){await R("frappe.client.set_value",{doctype:"CRM Organization",name:r.organizationId,fieldname:"organization_logo",value:(e==null?void 0:e.file_url)||""}),l.reload()}async function ee(){H({title:__("Delete organization"),message:__("Are you sure you want to delete this organization?"),actions:[{label:__("Delete"),theme:"red",variant:"solid",async onClick(e){await R("frappe.client.delete",{doctype:"CRM Organization",name:r.organizationId}),e(),Q.push({name:"Organizations"})}}]})}function ae(e){return e&&e.replace(/^(?:https?:\/\/)?(?:www\.)?/i,"")}function oe(){l.doc.website?window.open(l.doc.website,"_blank"):q({title:__("Website not found"),icon:"x",iconClasses:"text-red-600"})}const C=g(!1),te=g({}),I=g({}),v=je({url:"crm.api.doc.get_sidebar_fields",cache:["fieldsLayout",r.organizationId],params:{doctype:"CRM Organization",name:r.organizationId},auto:!0,transform:e=>ne(e)});function ne(e){return e.map(a=>({...a,fields:b(()=>a.fields.map(c=>c.name==="address"?{...c,create:(f,z)=>{te.value.address=f,I.value={},C.value=!0,z()},edit:async f=>{I.value=await R("frappe.client.get",{doctype:"Address",name:f}),C.value=!0}}:c))}))}const w=g(0),le=[{label:"Deals",icon:N(Ie,{class:"h-4 w-4"}),count:b(()=>{var e;return(e=S.data)==null?void 0:e.length})},{label:"Contacts",icon:N(Oe,{class:"h-4 w-4"}),count:b(()=>{var e;return(e=B.data)==null?void 0:e.length})}],S=A({type:"list",doctype:"CRM Deal",cache:["deals",r.organizationId],fields:["name","organization","currency","annual_revenue","status","email","mobile_no","deal_owner","modified"],filters:{organization:r.organizationId},orderBy:"modified desc",pageLength:20,auto:!0}),B=A({type:"list",doctype:"Contact",cache:["contacts",r.organizationId],fields:["name","full_name","image","email_id","mobile_no","company_name","modified"],filters:{company_name:r.organizationId},orderBy:"modified desc",pageLength:20,auto:!0}),h=b(()=>{let e=[];return e=w.value?B:S,e.data?e.data.map(a=>w.value?se(a):ie(a)):[]}),L=b(()=>w.value===0?re:de);function ie(e){var a,c;return{name:e.name,organization:{label:e.organization,logo:(a=r.organization)==null?void 0:a.organization_logo},annual_revenue:$e(e.annual_revenue,e.currency),status:{label:e.status,color:(c=K(e.status))==null?void 0:c.iconColorClass},email:e.email,mobile_no:e.mobile_no,deal_owner:{label:e.deal_owner&&D(e.deal_owner).full_name,...e.deal_owner&&D(e.deal_owner)},modified:{label:j(e.modified,E),timeAgo:__(T(e.modified))}}}function se(e){var a;return{name:e.name,full_name:{label:e.full_name,image_label:e.full_name,image:e.image},email:e.email_id,mobile_no:e.mobile_no,company_name:{label:e.company_name,logo:(a=r.organization)==null?void 0:a.organization_logo},modified:{label:j(e.modified,E),timeAgo:__(T(e.modified))}}}const re=[{label:__("Organization"),key:"organization",width:"11rem"},{label:__("Amount"),key:"annual_revenue",width:"9rem"},{label:__("Status"),key:"status",width:"10rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Mobile no"),key:"mobile_no",width:"11rem"},{label:__("Deal owner"),key:"deal_owner",width:"10rem"},{label:__("Last modified"),key:"modified",width:"8rem"}],de=[{label:__("Name"),key:"full_name",width:"17rem"},{label:__("Email"),key:"email",width:"12rem"},{label:__("Phone"),key:"mobile_no",width:"12rem"},{label:__("Organization"),key:"company_name",width:"12rem"},{label:__("Last modified"),key:"modified",width:"8rem"}];return(e,a)=>{const c=O("ErrorMessage"),f=O("FeatherIcon"),z=O("Button"),me=O("Badge");return n(),y(P,null,[t(l).doc?(n(),u(ye,{key:0},{"left-header":d(()=>[s(t(Ee),{items:Y.value},{prefix:d(({item:o})=>[o.icon?(n(),u(be,{key:0,icon:o.icon,class:"mr-2 h-4"},null,8,["icon"])):m("",!0)]),_:1},8,["items"])]),_:1})):m("",!0),i("div",Pe,[t(l).doc?(n(),u(ue,{key:0,parent:e.$refs.parentRef,class:"flex h-full flex-col overflow-hidden border-r"},{default:d(()=>[i("div",We,[s(t(Ae),{onSuccess:F,validateFile:Z},{default:d(({openFileSelector:o,error:_})=>[i("div",Ge,[i("div",Je,[i("div",He,[s(t(Me),{size:"3xl",class:"h-15.5 w-15.5",label:t(l).doc.organization_name,image:t(l).doc.organization_logo},null,8,["label","image"]),(n(),u($(t(l).doc.image?t(Ne):"div"),Te(t(l).doc.image?{options:[{icon:"upload",label:t(l).doc.image?e.__("Change image"):e.__("Upload image"),onClick:o},{icon:"trash-2",label:e.__("Remove image"),onClick:()=>F("")}]}:{onClick:o},{class:"!absolute bottom-0 left-0 right-0"}),{default:d(()=>[i("div",Ke,[s(Ce,{class:"h-6 w-6 cursor-pointer text-white"})])]),_:2},1040))]),i("div",Qe,[i("div",Xe,[i("span",null,k(t(l).doc.name),1)]),t(l).doc.website?(n(),y("div",Ye,[s(ke,{class:"size-4"}),i("span",null,k(ae(t(l).doc.website)),1)])):m("",!0),s(c,{message:e.__(_)},null,8,["message"])])]),i("div",Ze,[s(z,{label:e.__("Delete"),theme:"red",size:"sm",onClick:ee},{prefix:d(()=>[s(f,{name:"trash-2",class:"h-4 w-4"})]),_:1},8,["label"]),s(t(De),{text:e.__("Open website")},{default:d(()=>[i("div",null,[s(z,{onClick:oe},{default:d(()=>[s(f,{name:"link",class:"h-4 w-4"})]),_:1})])]),_:1},8,["text"])])])]),_:1})]),t(v).data?(n(),y("div",ea,[i("div",aa,[(n(!0),y(P,null,qe(t(v).data,(o,_)=>(n(),y("div",{key:o.label,class:M(["flex flex-col p-3",{"border-b":_!==t(v).data.length-1}])},[s(_e,{"is-opened":o.opened,label:o.label},{actions:d(()=>[_==0&&t(J)()?(n(),u(z,{key:0,variant:"ghost",class:"w-7",onClick:a[0]||(a[0]=U=>x.value=!0)},{default:d(()=>[s(xe,{class:"h-4 w-4"})]),_:1})):m("",!0)]),default:d(()=>[o.fields?(n(),u(fe,{key:0,fields:o.fields,isLastSection:_==t(v).data.length-1,modelValue:t(l).doc,"onUpdate:modelValue":a[1]||(a[1]=U=>t(l).doc=U),onUpdate:X},null,8,["fields","isLastSection","modelValue"])):m("",!0)]),_:2},1032,["is-opened","label"])],2))),128))])])):m("",!0)]),_:1},8,["parent"])):m("",!0),s(t(ge),{class:"overflow-hidden",modelValue:w.value,"onUpdate:modelValue":a[2]||(a[2]=o=>w.value=o),tabs:le},{tab:d(({tab:o,selected:_})=>[i("button",{class:M(["group flex items-center gap-2 border-b border-transparent py-2.5 text-base text-gray-600 duration-300 ease-in-out hover:border-gray-400 hover:text-gray-900",{"text-gray-900":_}])},[o.icon?(n(),u($(o.icon),{key:0,class:"h-5"})):m("",!0),W(" "+k(e.__(o.label))+" ",1),s(me,{class:M(["group-hover:bg-gray-900",[_?"bg-gray-900":"bg-gray-600"]]),variant:"solid",theme:"gray",size:"sm"},{default:d(()=>[W(k(o.count),1)]),_:2},1032,["class"])],2)]),default:d(({tab:o})=>[o.label==="Deals"&&h.value.length?(n(),u(he,{key:0,class:"mt-4",rows:h.value,columns:L.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):m("",!0),o.label==="Contacts"&&h.value.length?(n(),u(ze,{key:1,class:"mt-4",rows:h.value,columns:L.value,options:{selectable:!1,showTooltip:!1}},null,8,["rows","columns"])):m("",!0),h.value.length?m("",!0):(n(),y("div",oa,[i("div",ta,[(n(),u($(o.icon),{class:"!h-10 !w-10"})),i("div",null,k(e.__("No {0} Found",[e.__(o.label)])),1)])]))]),_:1},8,["modelValue"])],512),x.value?(n(),u(ce,{key:1,modelValue:x.value,"onUpdate:modelValue":a[3]||(a[3]=o=>x.value=o),doctype:"CRM Organization",onReload:a[4]||(a[4]=()=>t(v).reload())},null,8,["modelValue"])):m("",!0),V.value?(n(),u(ve,{key:2,modelValue:V.value,"onUpdate:modelValue":a[5]||(a[5]=o=>V.value=o),doctype:"CRM Organization"},null,8,["modelValue"])):m("",!0),s(we,{modelValue:C.value,"onUpdate:modelValue":a[6]||(a[6]=o=>C.value=o),address:I.value,"onUpdate:address":a[7]||(a[7]=o=>I.value=o)},null,8,["modelValue","address"])],64)}}};export{Ba as default};
//# sourceMappingURL=Organization-c4125a94.js.map
