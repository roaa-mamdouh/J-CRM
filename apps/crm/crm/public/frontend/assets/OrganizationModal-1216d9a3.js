import{F as K}from"./Fields-0a7d93b5.js";import{_ as X}from"./AddressModal-c9e0b8b2.js";import{E as Y}from"./views-29c7636e.js";import{_ as q,b as s,c,e as l,m as Z,v as ee,i as C,l as u,j as O,B as S,D as $,x as ae,I as w,k as te,r as D,d as g,w as V,t as N,u as z,g as k,p as E,F as I,f as F,G as ne,C as oe,L as le,z as se,A as j}from"./index-94cddbf2.js";import{W as ie}from"./WebsiteIcon-612bfcb9.js";import{O as re}from"./OrganizationsIcon-18979377.js";import{u as ue,h as ce}from"./index-79582337.js";const de={},me={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-circle-dollar-sign"},ve=l("circle",{cx:"12",cy:"12",r:"10"},null,-1),_e=l("path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"},null,-1),fe=l("path",{d:"M12 18V6"},null,-1),pe=[ve,_e,fe];function ge(m,v){return s(),c("svg",me,pe)}const he=q(de,[["render",ge]]),ye={},we={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5","stroke-linecap":"round","stroke-linejoin":"round",class:"lucide lucide-land-plot"},ze=l("path",{d:"m12 8 6-3-6-3v10"},null,-1),ke=l("path",{d:"m8 11.99-5.5 3.14a1 1 0 0 0 0 1.74l8.5 4.86a2 2 0 0 0 2 0l8.5-4.86a1 1 0 0 0 0-1.74L16 12"},null,-1),xe=l("path",{d:"m6.49 12.85 11.02 6.3"},null,-1),Me=l("path",{d:"M17.51 12.85 6.5 19.15"},null,-1),be=[ze,ke,xe,Me];function Ce(m,v){return s(),c("svg",we,be)}const Oe=q(ye,[["render",Ce]]),$e={class:"bg-white px-4 pb-6 pt-5 sm:px-6"},Ve={class:"mb-5 flex items-center justify-between"},Ee={class:"text-2xl font-semibold leading-6 text-gray-900"},Ie={class:"flex items-center gap-1"},Be={key:0,class:"flex flex-col gap-3.5"},Re={class:"grid w-7 place-content-center"},Se={key:0,class:"px-4 pb-7 pt-4 sm:px-6"},De={class:"space-y-2"},Qe={__name:"OrganizationModal",props:Z({options:{type:Object,default:{redirect:!0,detailMode:!1,afterInsert:()=>{}}}},{modelValue:{},modelModifiers:{},organization:{},organizationModifiers:{},quickEntry:{},quickEntryModifiers:{}}),emits:["update:modelValue","update:organization","update:quickEntry"],setup(m){const v=m,{isManager:U}=ue(),A=ee(),d=C(m,"modelValue"),x=C(m,"organization"),f=u(!1);u(null);const r=u(!1),p=u(!1);let _=u({}),n=u({organization_name:"",website:"",annual_revenue:"",no_of_employees:"1-10",industry:""});const h=u(!1);let y=u({});async function L(){const a={...y.value},e={...n.value},o=a.organization_name!==e.organization_name;delete a.organization_name,delete e.organization_name;const i=JSON.stringify(a)!==JSON.stringify(e),t=e;if(!o&&!i){d.value=!1;return}let b;f.value=!0,o&&(b=await Q()),i&&(b=await J(t)),B({name:b},o)}async function Q(){var e;const a=await w("frappe.client.rename_doc",{doctype:"CRM Organization",old_name:(e=y.value)==null?void 0:e.organization_name,new_name:n.value.organization_name});return f.value=!1,a}async function J(a){const e=await w("frappe.client.set_value",{doctype:"CRM Organization",name:n.value.name,fieldname:a});return f.value=!1,e.name}async function T(){const a=await w("frappe.client.insert",{doc:{doctype:"CRM Organization",...n.value}});f.value=!1,a.name&&(se("organization_created"),B(a))}function B(a,e=!1){var o,i;a.name&&(v.options.redirect||e)?A.push({name:"Organization",params:{organizationId:a.name}}):(i=(o=x.value).reload)==null||i.call(o),d.value=!1,v.options.afterInsert&&v.options.afterInsert(a)}const M=O(()=>{let a=p.value?__(n.value.organization_name):__("New Organization"),e=r.value?"":"xl",o=r.value?[]:[{label:p.value?__("Save"):__("Create"),variant:"solid",onClick:()=>p.value?L():T()}];return{title:a,size:e,actions:o}}),W=O(()=>[{icon:re,name:"organization_name",value:n.value.organization_name},{icon:ie,name:"website",value:n.value.website},{icon:Oe,name:"territory",value:n.value.territory},{icon:he,name:"annual_revenue",value:ce(n.value.annual_revenue,n.value.currency)},{icon:S($,{name:"hash",class:"h-4 w-4"}),name:"no_of_employees",value:n.value.no_of_employees},{icon:S($,{name:"briefcase",class:"h-4 w-4"}),name:"industry",value:n.value.industry}].filter(e=>e.value)),G=ae({url:"crm.fcrm.doctype.crm_fields_layout.crm_fields_layout.get_fields_layout",cache:["quickEntryFields","CRM Organization"],params:{doctype:"CRM Organization",type:"Quick Entry"},auto:!0}),R=O(()=>{let a=G.data||[];return a.length?(a.forEach(e=>{e.fields.forEach(o=>{o.name=="address"&&(o.create=(i,t)=>{n.value.address=i,_.value={},h.value=!0,t()},o.edit=async i=>{_.value=await w("frappe.client.get",{doctype:"Address",name:i}),h.value=!0})})}),a):[]});te(()=>d.value,a=>{a&&(p.value=!1,r.value=v.options.detailMode,j(()=>{var e;y.value=((e=x.value)==null?void 0:e.doc)||x.value||{},n.value={...y.value},n.value.name&&(p.value=!0)}))});const H=C(m,"quickEntry");function P(){H.value=!0,j(()=>{d.value=!1})}return(a,e)=>{const o=D("Button"),i=D("Dialog");return s(),c(I,null,[g(i,{modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=t=>d.value=t),options:M.value},{body:V(()=>[l("div",$e,[l("div",Ve,[l("div",null,[l("h3",Ee,N(a.__(M.value.title)||a.__("Untitled")),1)]),l("div",Ie,[z(U)()||r.value?(s(),k(o,{key:0,variant:"ghost",class:"w-7",onClick:e[0]||(e[0]=t=>r.value?r.value=!1:P())},{default:V(()=>[g(Y,{class:"h-4 w-4"})]),_:1})):E("",!0),g(o,{variant:"ghost",class:"w-7",onClick:e[1]||(e[1]=t=>d.value=!1)},{default:V(()=>[g(z($),{name:"x",class:"h-4 w-4"})]),_:1})])]),l("div",null,[r.value?(s(),c("div",Be,[(s(!0),c(I,null,F(W.value,t=>(s(),c("div",{class:"flex h-7 items-center gap-2 text-base text-gray-800",key:t.name},[l("div",Re,[(s(),k(ne(t.icon)))]),l("div",null,N(t.value),1)]))),128))])):R.value?(s(),k(K,{key:1,sections:R.value,data:z(n)},null,8,["sections","data"])):E("",!0)])]),r.value?E("",!0):(s(),c("div",Se,[l("div",De,[(s(!0),c(I,null,F(M.value.actions,t=>(s(),k(o,oe({class:"w-full",key:t.label},t,{label:a.__(t.label),loading:f.value}),null,16,["label","loading"]))),128))])]))]),_:1},8,["modelValue","options"]),g(X,{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=t=>h.value=t),address:z(_),"onUpdate:address":e[4]||(e[4]=t=>le(_)?_.value=t:_=t)},null,8,["modelValue","address"])],64)}}};export{Qe as _};
//# sourceMappingURL=OrganizationModal-1216d9a3.js.map
